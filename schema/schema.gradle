buildscript({
    // either sourced from composite build (-Pxapi.composite=true), or init/root cross-project configuration adds xapiRepo.
    dependencies {
        classpath group: 'net.wti.gradle.tools', name: 'xapi-gradle-tools', version: version, changing: true
    }
})

plugins {
    id 'xapi-schema'
}

xapiSchema {
    platforms {
        main
        gwt {
            replace 'main'
        }
//        jre {
//            replace main
//        }
//        server {
//            replace jre
//        }
//        vertx {
//            replace server
//        }
//        appengine {
//            replace server
//        }
    }
    archives {
        api
        spi
        main.require api, spi
        sample.require 'main'
        test.require 'sample', 'main' // hm. transitivity isn't really working, we have to redeclare require()d dependencies
                                      // highly likely to be related to callers of net.wti.gradle.internal.require.api.ArchiveGraph.srcExists
    }
}
tasks.create 'testSchema', {
    doLast {
        logger.quiet "$xapiSchema"
    }
}
