import net.wti.gradle.schema.api.Transitivity
buildscript {
    repositories {
        maven {
            name = 'xapiLocal'
            url = new URI("file://$rootDir/repo".toString())
            //noinspection UnstableApiUsage
            metadataSources({ m -> m.gradleMetadata() })
        }
    }
    dependencies {
        classpath 'com.github.jengelman.gradle.plugins:shadow:4.0.4'
        classpath "net.wti.gradle:xapi-gradle-meta:$version"
        classpath "net.wti.gradle.tools:xapi-gradle-tools:$version"
    }
}
plugins {
    id 'xapi-require'
    id 'xapi-meta'
}

plugins.apply 'com.github.johnrengelman.shadow'
setProperty('xapi.main.component', 'shadow')

tasks.jar.configure {
    classifier = 'default'
}

tasks.shadowJar.configure {
    classifier = null
}

xapiRequire.main().configure {
    req ->
        req.project 'xapi-util'
        req.project 'xapi-inject', 'gwt:main'
        req.project 'xapi-collect', 'gwt:main'
        req.project 'xapi-common', 'gwt:testTools'
        req.project 'xapi-gwt3', 'main'
        req.project 'xapi-dev-parent:xapi-dev-source', 'main'
        req.external "net.wti.core:xapi-lang-core:${->version}", 'main'
        req.project 'xapi-core-parent:xapi-core-reflect', 'main'
        req.project 'xapi-elemental', 'main'
        req.project 'xapi-model', 'gwt:main'
        req.project 'xapi-gwt-process', 'main'
        req.project 'xapi-io', 'gwt:main'
        req.project 'xapi-dev-gwtc:xapi-gwtc-api', 'main'
}

xapiRequire.module('test').configure {
    req ->
        req.external 'net.wetheinter:gwt-codeserver:2.8.0'
        req.external 'net.wetheinter:gwt-user:2.8.0'
        req.external 'net.sourceforge.htmlunit:htmlunit:2.19'
        req.external 'junit:junit:4.12'
        req.external Transitivity.runtime, 'junit:junit:4.12:sources'
}

description = 'XApi - Gwt uber jar'
